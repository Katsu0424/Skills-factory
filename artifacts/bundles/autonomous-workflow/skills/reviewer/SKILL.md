# reviewer

レビュー役スキル - コードレビューと完了判定を行う

## トリガー

- `conductor` からレビュー指示を受けた時
- `validator` 成功後
- `/reviewer` コマンド実行時

## 目的

実装されたコードの品質を人間の視点でレビューし、タスクの完了を判定する

---

## 入力

- 実装完了報告（変更内容）
- 検証結果レポート
- タスク定義（Done when）

## 出力

- レビュー結果（承認/差し戻し）
- （差し戻し時）指摘事項

---

## レビュー観点

### 1. 機能要件

- [ ] タスクのWhatを満たしているか
- [ ] Done when の条件をすべて満たしているか
- [ ] エッジケースが考慮されているか

### 2. コード品質

- [ ] 可読性が高いか
- [ ] 命名が適切か
- [ ] 複雑すぎないか（循環的複雑度）
- [ ] DRY原則に従っているか

### 3. 設計

- [ ] 既存アーキテクチャと整合しているか
- [ ] 責務が適切に分離されているか
- [ ] 将来の拡張を過度に阻害しないか

### 4. セキュリティ

- [ ] 入力バリデーションが適切か
- [ ] 認証・認可が正しく実装されているか
- [ ] 機密情報が露出していないか

### 5. パフォーマンス

- [ ] 明らかなパフォーマンス問題がないか
- [ ] N+1クエリなどのアンチパターンがないか

---

## 処理フロー

### 1. 変更内容の確認

実装された変更を詳細に確認：
- diff の確認
- 新規ファイルの確認
- 変更理由の理解

### 2. レビュー観点でのチェック

上記の観点でコードを精査

### 3. 完了条件の確認

Done when がすべて満たされているか確認：

```markdown
Done when: 各エンドポイントが正常動作

✓ /login - 200を返す（テストで確認済み）
✓ /logout - セッションが無効化される（テストで確認済み）
✓ /refresh - 新トークンが発行される（テストで確認済み）
```

### 4. 判定

問題なし → 承認
問題あり → 差し戻し（指摘事項付き）

---

## 出力テンプレート

### 承認時

```markdown
## レビュー結果: 承認 ✓

### サマリー

タスク「[タスク名]」の実装を承認します。

### 完了条件チェック

- [x] 各エンドポイントが正常動作
- [x] テスト通過
- [x] lint エラー 0
- [x] ビルド成功

### コメント

（任意のポジティブなコメントや改善提案）

### 次のステップ

次のタスクへ / 全タスク完了
```

### 差し戻し時

```markdown
## レビュー結果: 差し戻し ✗

### サマリー

以下の点を修正してください。

### 指摘事項

#### [必須] エラーハンドリング不足

```typescript
// 現在のコード
const user = await getUser(id);
return user.name;

// 問題: userがnullの場合にエラー

// 修正案
const user = await getUser(id);
if (!user) {
  throw new NotFoundError('User not found');
}
return user.name;
```

#### [推奨] 変数名の改善

`data` → `userData` の方が意図が明確です。

### 次のステップ

implementer による修正へ
```

---

## 指摘の優先度

| 優先度 | 説明 | 対応 |
|--------|------|------|
| **必須** | 修正しないと承認できない | 必ず修正 |
| **推奨** | 修正が望ましい | 可能なら修正 |
| **参考** | 次回以降の参考 | 任意 |

---

## 完了判定基準

以下がすべて満たされた場合、タスク完了：

- [x] Done when の条件をすべて満たす
- [x] 全テスト通過
- [x] lint エラー 0
- [x] ビルド成功
- [x] レビュー承認

---

## 制約

- 主観的な好みで差し戻さない
- 指摘は具体的かつ修正方法を示す
- 過度な完璧主義を避ける
- スコープ外の改善は「参考」として記載

---

## 次のスキル

- 承認 → `conductor` へ報告 → 次タスクまたは完了
- 差し戻し → `conductor` へ報告 → `implementer` へ
