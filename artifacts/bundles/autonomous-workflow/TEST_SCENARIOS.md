# autonomous-workflow テストシナリオ

## 前提条件

テスト対象プロジェクトの`.claude/skills/`に以下を配置：
- `dig/SKILL.md`
- `decompose/SKILL.md`
- `evaluate/SKILL.md`

---

## シナリオ1: シンプルな機能追加（推奨）

### タスク依頼
```
ユーザー管理機能にパスワードリセット機能を追加したい
```

### 期待される動作

#### Phase 1: /dig
1. コードベースを探索してコンテキスト収集
2. 以下のカテゴリで曖昧点を特定：
   - スコープ: メール送信？トークン有効期限？
   - 技術: 既存の認証方式は？
   - UX: リセットフロー（メール→リンク→新パスワード入力？）
   - 品質: セキュリティ要件は？
   - 運用: ログ出力？監視？
3. 2〜4個の質問を生成してユーザーに確認
4. 決定事項リストを出力

#### Phase 2: /decompose
1. 決定事項を元にタスク分解
2. 各タスクにWhat/Where/How/Why/Done whenを記載
3. 5〜30分単位のTODOリストを出力

#### Phase 3: /evaluate
1. 網羅性・粒度・明確性・依存関係・実現可能性をチェック
2. 評価レポートを出力
3. ユーザーに承認を求める

### 確認ポイント
- [ ] digで2〜4個の質問が生成されたか
- [ ] 質問に選択肢が含まれているか
- [ ] decomposeでタスクが5〜30分単位になっているか
- [ ] 各タスクにWhat/Where/How/Why/Done whenがあるか
- [ ] evaluateで評価レポートが出力されたか
- [ ] 承認リクエストが表示されたか

---

## シナリオ2: バグ修正

### タスク依頼
```
ログイン時にたまにセッションが切れるバグを直したい
```

### 期待される動作

#### Phase 1: /dig
1. 「たまに」の条件を明確化
2. セッション管理の実装を確認
3. 質問例：
   - 再現条件は特定できているか？
   - セッションストアは何を使用？
   - エラーログは確認済み？

#### Phase 2: /decompose
1. 調査タスクと修正タスクを分離
2. 例：
   - タスク1: ログ分析で再現パターン特定
   - タスク2: セッション管理コードの確認
   - タスク3: 修正実装
   - タスク4: テスト追加

### 確認ポイント
- [ ] 曖昧な「たまに」を明確化する質問があったか
- [ ] 調査タスクが含まれているか
- [ ] テストタスクが含まれているか

---

## シナリオ3: リファクタリング

### タスク依頼
```
APIのエラーハンドリングを統一したい
```

### 期待される動作

#### Phase 1: /dig
1. 現在のエラーハンドリングパターンを調査
2. 質問例：
   - 統一後のエラーレスポンス形式は？
   - 既存のエラーコード体系は維持？
   - 後方互換性は必要？

#### Phase 2: /decompose
1. 影響範囲の大きさに応じた分割
2. 例：
   - タスク1: エラーハンドリング基盤クラス作成
   - タスク2: 認証系エンドポイント適用
   - タスク3: ユーザー系エンドポイント適用
   - タスク4: テスト更新

### 確認ポイント
- [ ] 後方互換性について質問があったか
- [ ] 段階的な適用計画になっているか
- [ ] 影響範囲が明確か

---

## シナリオ4: 新規プロジェクト（曖昧度：高）

### タスク依頼
```
社内用のタスク管理ツールを作りたい
```

### 期待される動作

#### Phase 1: /dig
1. 多くの曖昧点を特定
2. 質問例：
   - Web/デスクトップ/モバイル？
   - 使用技術スタック？
   - ユーザー数の想定？
   - 認証方式？
   - 既存システムとの連携？

### 確認ポイント
- [ ] 曖昧度が高い場合、質問が4個になるか
- [ ] 優先度の高い質問から聞いているか
- [ ] 技術スタックが決まらないとdecomposeできないことを認識しているか

---

## テスト実行手順

### 1. テスト環境準備
```bash
# テスト用プロジェクトを作成
mkdir -p test-project/.claude/skills
cd test-project

# スキルをコピー
cp -r /path/to/Skills-factory/artifacts/bundles/autonomous-workflow/skills/* .claude/skills/
```

### 2. テスト実行
```bash
# Claude Codeを起動
claude

# シナリオ1を実行
> ユーザー管理機能にパスワードリセット機能を追加したい

# digスキルが起動することを確認
# 質問に回答

# decomposeを実行
> /decompose

# evaluateを実行
> /evaluate
```

### 3. 結果記録
各シナリオの確認ポイントをチェックし、問題があれば記録する。

---

## 既知の制限事項

- Do Phase（conductor/implementer/validator/reviewer）はこのテストでは対象外
- context: forkが正しく動作するかはClaude Code環境依存
