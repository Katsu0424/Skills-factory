# コミットメッセージ + 粒度分割ルール

## トリガー
`claude commit` 実行時に自動適用

## 目的
- Conventional Commits 形式でメッセージ生成
- レビューしやすい粒度に自動分割

---

## メッセージ形式

```
<type>(<scope>): <subject>

<body>

<footer>
```

### type

| type | 用途 | CHANGELOG |
|------|------|-----------|
| feat | 新機能 | Features |
| fix | バグ修正 | Bug Fixes |
| perf | パフォーマンス改善 | Performance |
| refactor | リファクタリング | - |
| docs | ドキュメント | - |
| test | テスト | - |
| chore | ビルド・設定 | - |
| ci | CI/CD | - |

### scope（任意）
変更対象のモジュール/機能名

例: api, auth, db, cli

### subject
- 50文字以内
- 日本語OK
- 命令形で書く
- 末尾にピリオドなし

### body（任意）
- 「何を」「なぜ」変更したか
- 72文字で折り返し

### footer（任意）
- `BREAKING CHANGE:` 破壊的変更の説明
- `Refs #123:` Issue参照
- `Co-authored-by:` 共同作者

### 例
```
feat(api): ユーザー認証エンドポイント追加

JWT認証を実装し、アクセストークンとリフレッシュトークンに対応。
既存のセッション認証は非推奨とする。

BREAKING CHANGE: /api/login のレスポンス形式変更
Refs #234
```

---

## 粒度分割ルール

### 原則
**1コミット = 1つの論理的変更**

### 分割判断

| ケース | 判断 |
|--------|------|
| 機能追加 + バグ修正 | 分割する |
| 本体変更 + テスト追加 | 同一コミット |
| リファクタ + 機能追加 | 分割する |
| 複数ファイルの同一目的変更 | 同一コミット |
| フォーマット修正 + ロジック変更 | 分割する |

### 動作フロー

```
claude commit 実行
    ↓
差分を分析
    ↓
複数の論理的変更を検出？
    ├─ No → 通常通りコミット
    └─ Yes → 分割案を提示
              ↓
         ユーザー確認（1回のみ）
              ↓
         自動で順番にステージング＆コミット
```

### 分割提示の出力形式

```
📦 以下の3つのコミットに分割することを提案します：

1. refactor(auth): 認証ロジックを関数に抽出
   - src/auth.rs (L42-58)

2. feat(auth): OAuth2認証を追加
   - src/auth.rs (L60-120)
   - src/config.rs (L15-20)

3. test(auth): OAuth2認証のテスト追加
   - tests/auth_test.rs (全体)

この順序でコミットしますか？ [y/n/編集]
```

---

## 適用手順

1. `git diff --staged` および `git diff` で差分を取得
2. 変更内容を論理的な単位で分類
3. 複数の論理的変更がある場合は分割案を提示
4. ユーザー確認後、順番にステージング＆コミット
5. 各コミットでConventional Commits形式のメッセージを生成
