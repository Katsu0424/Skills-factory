# PR説明生成ルール

## トリガー
`claude pr` 実行時に自動適用

## 目的
- 既存テンプレート（`.github/pull_request_template.md`）を自動で埋める
- コミット詳細セクションを「概要」の下に挿入

---

## 動作フロー

```
claude pr 実行
    ↓
.github/pull_request_template.md を読み込み
    ↓
テンプレートの空欄を差分から推測して埋める
    ↓
「概要」セクションの下にコミット詳細を挿入
    ↓
PR説明を出力
```

---

## コミット詳細セクションの形式

「概要」セクションの直後に以下を挿入する：

```markdown
## コミット詳細
| コミット | 内容 |
|----------|------|
| refactor(auth): 認証ロジックを関数に抽出 | 重複していた認証処理を `validate_token()` に統合 |
| feat(auth): OAuth2認証を追加 | Google/GitHub OAuth2 対応 |
| test(auth): OAuth2認証のテスト追加 | 正常系・異常系のテストケース追加 |
```

---

## コミット内容の要約ルール

1. コミットメッセージのbodyがあればそれを使用
2. bodyがなければ差分から1-2文で要約

---

## 適用手順

1. `git log --oneline main..HEAD` でPR対象のコミット一覧を取得
2. 各コミットの差分とメッセージを分析
3. `.github/pull_request_template.md` を読み込み
4. テンプレートの各セクションを自動で埋める：
   - **概要**: コミット全体の目的を要約
   - **変更内容**: 主な変更点を箇条書き
   - **テスト方法**: 変更に応じたテスト手順を提案
   - **影響範囲**: 変更が影響するモジュール/機能
5. 「概要」セクションの下にコミット詳細テーブルを挿入
6. 完成したPR説明を出力

---

## テンプレートがない場合

`.github/pull_request_template.md` が存在しない場合は、以下のデフォルト構造で生成：

```markdown
## 概要
（変更の目的と背景）

## コミット詳細
| コミット | 内容 |
|----------|------|
| ... | ... |

## 変更内容
- 変更点1
- 変更点2

## テスト方法
- [ ] テスト項目1
- [ ] テスト項目2

## 影響範囲
- 影響するモジュール/機能

## 補足
（レビュアーへの補足事項）
```
